# EcoCusco - Plataforma de Gesti√≥n de Residuos S√≥lidos Urbanos

![EcoCusco Logo](public/assets/img/logo-eco.png)

## üìã Descripci√≥n

EcoCusco es una plataforma web colaborativa dise√±ada para la gesti√≥n eficiente de residuos s√≥lidos urbanos en la ciudad de Cusco. Permite a los ciudadanos reportar puntos de acumulaci√≥n de residuos mediante geolocalizaci√≥n, seguir el estado de sus reportes y colaborar con las autoridades locales para mantener una ciudad m√°s limpia y sostenible.

## ‚ú® Caracter√≠sticas Principales

### üéØ Funcionalidades Core
- **Reportes Geolocalizados**: Permite reportar puntos de acumulaci√≥n de residuos con ubicaci√≥n GPS exacta
- **Sistema de Autenticaci√≥n**: Registro y login seguro de usuarios
- **Dashboard Personalizado**: Panel de control adaptado seg√∫n el tipo de usuario
- **Estad√≠sticas en Tiempo Real**: M√©tricas y gr√°ficos sobre la gesti√≥n de residuos
- **Gesti√≥n de Estados**: Seguimiento completo del ciclo de vida de los reportes

### üèóÔ∏è Arquitectura y Patrones
- **Arquitectura MVC**: Separaci√≥n clara de responsabilidades
- **Patr√≥n Singleton**: Para conexi√≥n a base de datos
- **Patr√≥n Factory**: Para creaci√≥n de instancias de controladores
- **Patr√≥n Repository**: Para acceso a datos consistente
- **PSR-4 Autoloading**: Carga autom√°tica de clases

### üîí Seguridad
- **Prepared Statements**: Prevenci√≥n de inyecci√≥n SQL
- **Validaci√≥n de Entrada**: Sanitizaci√≥n y validaci√≥n de todos los datos
- **Tokens CSRF**: Protecci√≥n contra ataques de falsificaci√≥n
- **Hash de Contrase√±as**: Almacenamiento seguro usando password_hash()

## üöÄ Instalaci√≥n

### Prerequisitos
- PHP 7.4 o superior
- MySQL 5.7 o superior
- Servidor web (Apache/Nginx)
- Composer (opcional, para dependencias futuras)

### 1. Clonar o Descargar el Proyecto
```bash
# Si tienes git instalado
git clone [repository-url] ecocusco
cd ecocusco

# O descargar y extraer el archivo ZIP
```

### 2. Configurar el Servidor Web

#### Apache
Configurar el DocumentRoot hacia la carpeta `public/`:
```apache
<VirtualHost *:80>
    DocumentRoot /path/to/ecocusco/public
    ServerName ecocusco.local
    
    <Directory /path/to/ecocusco/public>
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

#### Nginx
```nginx
server {
    listen 80;
    server_name ecocusco.local;
    root /path/to/ecocusco/public;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### 3. Configurar la Base de Datos

#### Crear la Base de Datos
```sql
CREATE DATABASE reciclaje_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### Importar la Estructura
```sql
-- Tabla de usuarios
CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    apellidos VARCHAR(50) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    telefono VARCHAR(20),
    direccion VARCHAR(200),
    fecha_nacimiento DATE,
    tipo_usuario ENUM('ciudadano', 'admin') DEFAULT 'ciudadano',
    estado BOOLEAN DEFAULT TRUE,
    ultima_actividad DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabla de reportes
CREATE TABLE reportes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL,
    ubicacion VARCHAR(200) NOT NULL,
    latitud DECIMAL(10, 8),
    longitud DECIMAL(11, 8),
    tipo_residuo VARCHAR(100) NOT NULL,
    descripcion TEXT NOT NULL,
    urgencia TINYINT DEFAULT 2,
    estado ENUM('pendiente', 'en_proceso', 'resuelto', 'rechazado') DEFAULT 'pendiente',
    imagen_url VARCHAR(255),
    direccion_exacta VARCHAR(300),
    fecha_reporte DATETIME DEFAULT CURRENT_TIMESTAMP,
    fecha_resolucion DATETIME NULL,
    comentario_resolucion TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE,
    INDEX idx_estado (estado),
    INDEX idx_urgencia (urgencia),
    INDEX idx_fecha_reporte (fecha_reporte)
);
```

### 4. Configurar Variables de Entorno

Copiar el archivo de ejemplo y configurar:
```bash
cp .env.example .env
```

Editar el archivo `.env`:
```env
# Configuraci√≥n de la aplicaci√≥n
APP_NAME="EcoCusco - Gesti√≥n de Residuos"
APP_ENV=development
APP_DEBUG=true
APP_URL=http://localhost

# Configuraci√≥n de base de datos
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=reciclaje_platform
DB_USERNAME=root
DB_PASSWORD=tu_password

# Configuraci√≥n de sesiones
SESSION_LIFETIME=120
SESSION_DRIVER=file
```

### 5. Configurar Permisos

```bash
# Dar permisos de escritura a las carpetas necesarias
chmod -R 755 storage/
chmod -R 755 public/uploads/
chown -R www-data:www-data storage/
chown -R www-data:www-data public/uploads/
```

### 6. Probar la Instalaci√≥n

Visitar `http://ecocusco.local` (o tu dominio configurado) y verificar que la aplicaci√≥n carga correctamente.

## üìÇ Estructura del Proyecto

```
reciclaje_platform_mvc/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/          # Controladores MVC
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardController.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HomeController.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ReportsController.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StatisticsController.php
‚îÇ   ‚îú‚îÄ‚îÄ Core/                 # Clases del framework
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Config.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controller.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Database.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Factory.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Model.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Request.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Router.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Validator.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ View.php
‚îÇ   ‚îú‚îÄ‚îÄ Models/               # Modelos de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Report.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ User.php
‚îÇ   ‚îî‚îÄ‚îÄ Views/                # Vistas de la aplicaci√≥n
‚îÇ       ‚îú‚îÄ‚îÄ auth/
‚îÇ       ‚îú‚îÄ‚îÄ dashboard/
‚îÇ       ‚îú‚îÄ‚îÄ home/
‚îÇ       ‚îú‚îÄ‚îÄ layouts/
‚îÇ       ‚îî‚îÄ‚îÄ reports/
‚îú‚îÄ‚îÄ config/                   # Archivos de configuraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ app.php
‚îÇ   ‚îî‚îÄ‚îÄ database.php
‚îú‚îÄ‚îÄ public/                   # Punto de entrada web
‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ img/
‚îÇ   ‚îú‚îÄ‚îÄ uploads/
‚îÇ   ‚îî‚îÄ‚îÄ index.php
‚îú‚îÄ‚îÄ storage/                  # Almacenamiento de archivos
‚îÇ   ‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îî‚îÄ‚îÄ logs/
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ composer.json
‚îî‚îÄ‚îÄ README.md
```

## üéÆ Uso de la Aplicaci√≥n

### Para Ciudadanos

1. **Registro**: Crear una cuenta en `/register`
2. **Login**: Iniciar sesi√≥n en `/login`
3. **Reportar**: Crear nuevo reporte en `/reportes/crear`
4. **Seguimiento**: Ver estado de reportes en `/dashboard`

### Para Administradores

1. **Dashboard**: Panel completo en `/dashboard`
2. **Gesti√≥n de Reportes**: Cambiar estados y asignar resoluciones
3. **Estad√≠sticas**: Ver m√©tricas completas en `/estadisticas`
4. **Exportaci√≥n**: Descargar datos en formato CSV

## üîß Configuraci√≥n Avanzada

### Personalizar Estilos
Editar `/public/assets/css/main.css` para modificar la apariencia:
```css
:root {
    --primary-color: #2E7D32;    /* Color principal */
    --primary-light: #4CAF50;    /* Color claro */
    --primary-dark: #1B5E20;     /* Color oscuro */
}
```

### Agregar Nuevas Rutas
En `/app/Core/Router.php`, m√©todo `defineRoutes()`:
```php
$this->get('/nueva-ruta', 'NuevoController@metodo');
$this->post('/procesar', 'NuevoController@procesar');
```

### Crear Nuevo Controlador
```php
<?php
namespace App\Controllers;

use App\Core\Controller;

class NuevoController extends Controller
{
    public function index()
    {
        $this->render('nueva-vista/index', [
            'pageTitle' => 'Nueva P√°gina'
        ]);
    }
}
```

## üìä API Endpoints

### Estad√≠sticas
- `GET /api/estadisticas` - Obtener estad√≠sticas generales
- `GET /api/estadisticas?type=monthly` - Estad√≠sticas mensuales

### Reportes
- `GET /api/reportes/mapa` - Datos para mapa interactivo
- `POST /api/reportes/{id}/estado` - Actualizar estado de reporte

### Dashboard
- `GET /api/dashboard/data` - Datos del dashboard

## üõ°Ô∏è Seguridad

### Validaci√≥n de Entrada
```php
$validation = $this->validate($this->request->all(), [
    'email' => 'required|email|max:150',
    'password' => 'required|string|min:8',
    'nombre' => 'required|string|max:50'
]);
```

### Protecci√≥n CSRF
```php
// En las vistas
<?= $this->csrfField() ?>

// En los controladores
if (!$this->verifyCsrfToken()) {
    // Manejar token inv√°lido
}
```

## üöÄ Optimizaci√≥n y Performance

### Cache de Configuraci√≥n
Las configuraciones se cargan una sola vez por request y se mantienen en memoria.

### Conexi√≥n Singleton
La conexi√≥n a base de datos usa el patr√≥n Singleton para evitar m√∫ltiples conexiones.

### Consultas Optimizadas
Todos los modelos usan prepared statements y consultas optimizadas con √≠ndices apropiados.

## üîç Debugging

### Habilitar Debug
En `.env`:
```env
APP_DEBUG=true
```

### Logs de Error
Los errores se registran en `/storage/logs/` cuando debug est√° deshabilitado.

### Validaci√≥n de Datos
```php
// Ejemplo de validaci√≥n personalizada
$validation = $this->validate($data, [
    'urgencia' => 'required|integer|min:1|max:4',
    'tipo_residuo' => 'required|string|in:Org√°nicos,Pl√°stico,Papel'
]);
```

## ü§ù Contribuci√≥n

### Agregar Nueva Funcionalidad

1. **Crear Modelo**: Si necesitas nueva tabla
2. **Crear Controlador**: Para manejar la l√≥gica
3. **Crear Vistas**: Para la interfaz de usuario
4. **Agregar Rutas**: En el router
5. **Probar**: Verificar funcionalidad completa

### Est√°ndares de C√≥digo

- Seguir PSR-4 para autoloading
- Usar camelCase para m√©todos
- Usar PascalCase para clases
- Documentar funciones p√∫blicas
- Validar siempre los datos de entrada

## üì± Responsive Design

La aplicaci√≥n est√° optimizada para:
- **Desktop**: Experiencia completa
- **Tablet**: Interfaz adaptada
- **Mobile**: Dise√±o mobile-first

## üåê Internacionalizaci√≥n

El sistema est√° preparado para m√∫ltiples idiomas:
- Espa√±ol (por defecto)
- Estructura preparada para agregar m√°s idiomas

## üìà M√©tricas y Analytics

### Estad√≠sticas Incluidas
- Total de reportes por per√≠odo
- Distribuci√≥n por tipo de residuo
- Tiempo promedio de resoluci√≥n
- Usuarios m√°s activos
- Zonas con m√°s reportes

### Exportaci√≥n de Datos
- CSV para reportes
- CSV para usuarios
- Resumen ejecutivo

## üÜò Soporte y Troubleshooting

### Problemas Comunes

**Error de conexi√≥n a base de datos:**
- Verificar credenciales en `.env`
- Confirmar que MySQL est√© ejecut√°ndose
- Revisar permisos de usuario de BD

**Error 500:**
- Habilitar `APP_DEBUG=true`
- Revisar logs en `/storage/logs/`
- Verificar permisos de carpetas

**Rutas no funcionan:**
- Verificar configuraci√≥n de servidor web
- Confirmar que mod_rewrite est√© habilitado (Apache)
- Revisar configuraci√≥n de try_files (Nginx)

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver archivo `LICENSE` para m√°s detalles.

## üë• Equipo

Desarrollado por el equipo EcoCusco para contribuir a una ciudad m√°s sostenible.

---

**EcoCusco** - Trabajando juntos por un Cusco m√°s verde üå±
